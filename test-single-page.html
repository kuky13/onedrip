<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PDF Uma Página</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>Teste PDF - Uma Página Única</h1>
    <button onclick="testPDF()">Gerar PDF de Teste</button>
    
    <script>
        function testPDF() {
            // Dados de teste completos
            const testBudgetData = {
                serviceType: 'Instalação de Ar Condicionado',
                description: 'Instalação completa de ar condicionado split 12000 BTUs com tubulação e suporte',
                cashPrice: 1500,
                installmentPrice: 1650,
                installmentCount: 3,
                paymentMethod: 'Cartão de Crédito',
                warranty: '12 meses',
                warrantyDetails: 'Garantia total contra defeitos de fabricação e instalação',
                emissionDate: new Date().toLocaleDateString('pt-BR'),
                validityDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR'),
                includedServices: [
                    '• Busca e entrega do aparelho',
                    '• Instalação completa com tubulação'
                ]
            };
            
            const testCompanyData = {
                name: 'OneDrip Climatização',
                phone: '(11) 99999-9999',
                email: 'contato@onedrip.com.br',
                address: 'São Paulo, SP'
            };
            
            console.log('Iniciando geração do PDF de teste...');
            console.log('Dados do orçamento:', testBudgetData);
            console.log('Dados da empresa:', testCompanyData);
            
            try {
                // Simular a geração do PDF usando a mesma lógica do sistema
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configurações básicas
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 10;
                let yPosition = 15;
                
                console.log('Dimensões da página:', { width: pageWidth, height: pageHeight });
                console.log('Posição Y inicial:', yPosition);
                
                // Título
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('ORDEM DE SERVIÇO', pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 20;
                
                // Detalhes do serviço
                doc.setFontSize(10);
                doc.text('DETALHES DO SERVIÇO', margin, yPosition);
                yPosition += 15;
                
                doc.setFontSize(8);
                doc.text(`Serviço: ${testBudgetData.serviceType}`, margin, yPosition);
                yPosition += 10;
                doc.text(`Descrição: ${testBudgetData.description}`, margin, yPosition);
                yPosition += 15;
                
                // Valores
                doc.setFontSize(10);
                doc.text('VALORES DO SERVIÇO', margin, yPosition);
                yPosition += 15;
                
                doc.setFontSize(8);
                doc.text(`À Vista: R$ ${testBudgetData.cashPrice.toFixed(2)}`, margin, yPosition);
                yPosition += 10;
                doc.text(`Parcelado: R$ ${testBudgetData.installmentPrice.toFixed(2)}`, margin, yPosition);
                yPosition += 15;
                
                // Garantia
                doc.setFontSize(10);
                doc.text('GARANTIA', margin, yPosition);
                yPosition += 15;
                
                doc.setFontSize(8);
                doc.text(`Período: ${testBudgetData.warranty}`, margin, yPosition);
                yPosition += 10;
                doc.text(`Detalhes: ${testBudgetData.warrantyDetails}`, margin, yPosition);
                yPosition += 15;
                
                // Serviços Inclusos
                doc.setFontSize(10);
                doc.text('SERVIÇOS INCLUSOS', margin, yPosition);
                yPosition += 15;
                
                testBudgetData.includedServices.forEach(service => {
                    doc.setFontSize(8);
                    doc.text(service, margin, yPosition);
                    yPosition += 8;
                });
                
                console.log('Posição Y final:', yPosition);
                console.log('Altura da página:', pageHeight);
                console.log('Espaço restante:', pageHeight - yPosition);
                
                if (yPosition > pageHeight - 20) {
                    console.warn('ATENÇÃO: O conteúdo pode estar ultrapassando a página!');
                    console.warn('Posição Y final:', yPosition, 'vs Altura da página:', pageHeight);
                } else {
                    console.log('✅ Todo o conteúdo cabe em uma única página!');
                }
                
                // Salvar o PDF
                doc.save('teste-uma-pagina.pdf');
                console.log('PDF gerado com sucesso!');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
            }
        }
    </script>
</body>
</html>