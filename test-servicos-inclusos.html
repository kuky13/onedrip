<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Se√ß√£o SERVI√áOS INCLUSOS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background 0.3s;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .test-data {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste da Se√ß√£o SERVI√áOS INCLUSOS</h1>
        
        <div class="test-info">
            <h3>üìã Objetivo do Teste</h3>
            <p>Verificar se a se√ß√£o <strong>"SERVI√áOS INCLUSOS"</strong> aparece completa em uma √∫nica p√°gina, sem ser cortada.</p>
            <p><strong>Corre√ß√£o implementada:</strong> Verifica√ß√£o de espa√ßo dispon√≠vel na p√°gina antes de renderizar a se√ß√£o.</p>
        </div>

        <div class="test-info">
            <h3>üîß Dados de Teste</h3>
            <p>O teste usar√° dados que incluem <strong>ambos os servi√ßos</strong>:</p>
            <ul>
                <li>‚úÖ <strong>includes_delivery:</strong> true (Busca e entrega do aparelho)</li>
                <li>‚úÖ <strong>includes_screen_protector:</strong> true (Pel√≠cula 3D de brinde)</li>
            </ul>
            <p>Isso garantir√° que a se√ß√£o tenha o m√°ximo de conte√∫do poss√≠vel para testar o corte.</p>
        </div>

        <button class="test-button" onclick="testPDFGeneration()">üöÄ Gerar PDF de Teste</button>
        <button class="test-button" onclick="testPDFWithLongContent()">üìÑ Teste com Conte√∫do Longo</button>
        
        <div id="test-results"></div>
    </div>

    <script type="module">
        // Importar as fun√ß√µes necess√°rias
        import { generateBudgetPDF } from './src/utils/pdfUtils.js';
        
        // Dados de teste da empresa
        const testCompanyData = {
            shop_name: 'OneDrip Assist√™ncia T√©cnica',
            address: 'Rua das Flores, 123\nCentro, S√£o Paulo - SP\nCEP: 01234-567',
            contact_phone: '(11) 98765-4321',
            email: 'contato@onedrip.com.br',
            cnpj: '12.345.678/0001-90',
            logo_url: 'https://via.placeholder.com/150x150/007bff/ffffff?text=LOGO'
        };
        
        // Dados de teste do or√ßamento com AMBOS os servi√ßos inclusos
        const testBudgetData = {
            id: 'test-servicos-inclusos-001',
            client_name: 'Maria Santos',
            client_phone: '(11) 88888-8888',
            device_type: 'Smartphone',
            device_model: 'Samsung Galaxy S21 Ultra',
            total_price: 650.00,
            installment_price: 216.67,
            installments: 3,
            warranty_months: 12,
            notes: 'Tela quebrada, bateria viciada, alto-falante com problema. Cliente relatou queda na √°gua e posterior secagem inadequada. Aparelho apresenta oxida√ß√£o em alguns componentes internos.',
            created_at: new Date().toISOString(),
            expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
            part_quality: 'Original',
            includes_delivery: true,        // ‚úÖ ATIVO
            includes_screen_protector: true, // ‚úÖ ATIVO
            installment_count: 3,
            validity_date: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
        };
        
        // Dados de teste com conte√∫do mais longo para for√ßar quebra de p√°gina
        const testBudgetDataLong = {
            ...testBudgetData,
            id: 'test-servicos-inclusos-long-002',
            notes: 'Tela quebrada, bateria viciada, alto-falante com problema, c√¢mera traseira danificada, bot√£o home n√£o funciona, conector de carregamento solto, carca√ßa arranhada, vidro traseiro trincado. Cliente relatou queda m√∫ltiplas vezes, exposi√ß√£o √† √°gua, uso inadequado do carregador. Aparelho apresenta oxida√ß√£o severa em componentes internos, necessitando limpeza completa da placa m√£e. Hist√≥rico de reparos anteriores mal executados por outras assist√™ncias. Garantia estendida solicitada devido √† complexidade do reparo. Pe√ßas originais obrigat√≥rias conforme exig√™ncia do cliente. Prazo de entrega estendido devido √† disponibilidade de componentes espec√≠ficos.',
            warranty_months: 24 // Garantia estendida
        };
        
        // Fun√ß√£o para testar a gera√ß√£o de PDF
        window.testPDFGeneration = async function() {
            try {
                console.log('=== TESTE SE√á√ÉO SERVI√áOS INCLUSOS ===');
                console.log('Dados da empresa:', testCompanyData);
                console.log('Dados do or√ßamento:', testBudgetData);
                
                console.log('Iniciando gera√ß√£o de PDF...');
                
                // Gerar o PDF
                const pdfBlob = await generateBudgetPDF(testBudgetData, testCompanyData);
                
                console.log('‚úÖ PDF gerado com sucesso!');
                console.log('üìä Tamanho do PDF:', pdfBlob.size, 'bytes');
                
                // Criar URL para download
                const url = URL.createObjectURL(pdfBlob);
                
                // Criar link para download
                const link = document.createElement('a');
                link.href = url;
                link.download = `teste-servicos-inclusos-${new Date().getTime()}.pdf`;
                link.click();
                
                // Limpar URL
                URL.revokeObjectURL(url);
                
                // Mostrar resultado
                document.getElementById('test-results').innerHTML = `
                    <div class="test-data">
                        ‚úÖ <strong>PDF GERADO COM SUCESSO!</strong>\n
                        üìã <strong>Dados do Teste:</strong>\n
                        üè¢ <strong>Empresa:</strong> ${testCompanyData.shop_name}\n
                        üì± <strong>Aparelho:</strong> ${testBudgetData.device_model}\n
                        üí∞ <strong>Valor:</strong> R$ ${testBudgetData.total_price.toFixed(2)}\n
                        üöö <strong>Busca e Entrega:</strong> ${testBudgetData.includes_delivery ? '‚úÖ SIM' : '‚ùå N√ÉO'}\n
                        üõ°Ô∏è <strong>Pel√≠cula 3D:</strong> ${testBudgetData.includes_screen_protector ? '‚úÖ SIM' : '‚ùå N√ÉO'}\n
                        üìÑ <strong>Tamanho do PDF:</strong> ${pdfBlob.size} bytes\n
                        üéØ <strong>Verifica√ß√£o:</strong> Abra o PDF e verifique se a se√ß√£o "SERVI√áOS INCLUSOS" aparece completa em uma √∫nica p√°gina.
                    </div>
                `;
                
            } catch (error) {
                console.error('‚ùå Erro ao gerar PDF:', error);
                document.getElementById('test-results').innerHTML = `
                    <div class="test-data" style="color: red;">
                        ‚ùå <strong>ERRO AO GERAR PDF:</strong>\n\n${error.message || error}
                    </div>
                `;
            }
        };
        
        // Fun√ß√£o para testar com conte√∫do longo
        window.testPDFWithLongContent = async function() {
            try {
                console.log('=== TESTE COM CONTE√öDO LONGO ===');
                
                const pdfBlob = await generateBudgetPDF(testBudgetDataLong, testCompanyData);
                
                const url = URL.createObjectURL(pdfBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `teste-servicos-inclusos-longo-${new Date().getTime()}.pdf`;
                link.click();
                URL.revokeObjectURL(url);
                
                document.getElementById('test-results').innerHTML = `
                    <div class="test-data">
                        ‚úÖ <strong>PDF COM CONTE√öDO LONGO GERADO!</strong>\n
                        üìã Este teste for√ßa uma situa√ß√£o onde h√° muito conte√∫do antes da se√ß√£o "SERVI√áOS INCLUSOS".\n
                        üéØ <strong>Verifica√ß√£o:</strong> Abra o PDF e confirme que a se√ß√£o "SERVI√áOS INCLUSOS" n√£o foi cortada.
                    </div>
                `;
                
            } catch (error) {
                console.error('‚ùå Erro:', error);
                document.getElementById('test-results').innerHTML = `
                    <div class="test-data" style="color: red;">
                        ‚ùå <strong>ERRO:</strong>\n\n${error.message || error}
                    </div>
                `;
            }
        };
        
    </script>
</body>
</html>